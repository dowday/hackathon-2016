require("data",function(e,n){function r(e){if(Array.isArray(e)){"number"!=typeof e.$key&&(e.$key=1);var n=[];e.forEach(function(t){("object"!=typeof t||Array.isArray(t))&&(t={value:t}),"number"!=typeof t.$key&&(t.$key=e.$key++),r(t),n.push(t)}),e.splice(0,e.length),n.forEach(function(n){e.push(n)})}else if("object"==typeof e){var t;for(t in e)r(e[t])}}function t(n,r){switch(r){case"date":return n=e.num2dat(n),i[n.getMonth()]+" "+n.getDate()+", "+n.getFullYear();case"time":return n=e.num2dat(n),n.getHours()+":"+e.pad(n.getMinutes());case"datetime":return n=e.num2dat(n),i[n.getMonth()]+" "+n.getDate()+", "+n.getFullYear()+"  "+n.getHours()+":"+e.pad(n.getMinutes())}return n}function a(e){var n,r,t=0,a=0,u=0,o=[];for(a=0;a<e.length;a++)r=e.charAt(a),0==u?"["!=r&&"."!=r||(n={name:e.substr(t,a-t)},o.push(n),t=a+1,"["==r&&(u=1)):-1==u?"."==r?(t=a+1,u=0):console.error("Bad var name!\n"+e+"\nPos: "+a):"["==r?u++:"]"==r&&(u--,0==u&&(n.index=e.substr(t,a-t),t=a+1,u=-1));return 0==u?o.push({name:e.substr(t)}):console.error("Bad ending for var name!\n"+e),o}var u=(require("tfw.web-service"),require("tfw.storage").local),o=u.get("data",{})||{},i=["January","February","March","April","May","June","July","August","September","October","November","December"];e.log=function(e){e?console.info("[data] DATA=...",JSON.stringify(o,null,"  ")):console.info("[data] DATA=...",o)},e.get=function(n){var r,t,u,i=o,f=a(n);for(u=0;u<f.length;u++){if(r=f[u],i=i[r.name],"undefined"==typeof i)return;if(Array.isArray(i)&&r.index&&(t=e.get(r.index),i=i.find(function(e){return e.$key==t}),"undefined"==typeof i))return void console.error("Key `"+t+"` not found in `"+n+"` at level "+u+"!")}return i},e.set=function(n,t){"undefined"==typeof t&&(t=""),t=JSON.parse(JSON.stringify(t)),r(t);var u,i,f,s,d=o,y=a(n);for(s=0;s<y.length-1;s++)i=y[s],"undefined"==typeof d[i.name]&&(y.index?d[i.name]=[{$key:e.get(i.index)}]:d[i.name]={}),d=d[i.name],i.index&&(f=e.get(i.index),u=d.find(function(e){return e.$key==f}),"undefined"==typeof u?d.push({$key:f}):d=u);d[y.pop().name]=t},e.reset=function(){o={},e.save()},e.save=function(){u.set("data",o)},e.parse=function(n,r){if("undefined"==typeof r&&(r={}),Array.isArray(n)){var a,u,o;for(a=0;a<n.length;a++)if(u=n[a],o=e.parse(u),"undefined"!=typeof o&&"null"!==o)return o}else{if("function"==typeof n)return e.parse(n.call(e));if("string"==typeof n){for(var i,f,s,d=0,y="";;){if(i=n.indexOf("{{",d),-1==i)break;if(y+=n.substr(d,i-d),d=i+2,f=n.indexOf("}}",d),-1==f)break;for(s=n.substr(d,f-d).trim().split("|"),"undefined"!=typeof r[s[0]]?s[0]=r[s[0]]:s[0]=e.get(s[0])||"",a=1;a<s.length;a++)s[0]=t(s[0],s[a]);y+=s[0],d=f+2}return y+n.substr(d)}}},e.num2dat=function(e){for(var n=""+e;n.length<12;)n+="0";return new Date(parseInt(n.substr(0,4)),parseInt(n.substr(4,2))-1,parseInt(n.substr(6,2)),parseInt(n.substr(8,2)),parseInt(n.substr(10,2)),0)},e.pad=function(e,n,r){for("undefined"==typeof n&&(n=2),"undefined"==typeof r&&(r="0"),e=""+e;e.length<n;)e=r+e;return e},e.push=function(n,t){var a=e.get(n);return Array.isArray(a)?(r(a),("object"!=typeof t||Array.isArray(t))&&(t={value:t}),t.$key=a.$key++,a.push(t),t.$key):(console.error("[Data.push] `"+n+"` is not an array!"),0)},e.remove=function(n,r){var t=e.get(n),a=e.get(r),u=t.findIndex(function(e){return e.$key==a});return-1==u?!1:(t.splice(u,1),!0)}});
//# sourceMappingURL=data.js.map