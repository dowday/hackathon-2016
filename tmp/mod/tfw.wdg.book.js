{"intl":"","src":"require( 'tfw.wdg.book', function(exports, module) {  \"use strict\";\r\nvar Hash = require(\"tfw.hash-watcher\");\r\nvar Widget = require(\"wdg\");\r\n\r\n/**\r\n * @example\r\n * <div id=\"book-id\">\r\n *   <div data-page=\"welcome\">...</div>\r\n *   <div data-page=\"game\">...</div>\r\n *   <div data-page=\"highscores\">...</div>\r\n * </div>\r\n *\r\n * @example\r\n * var Book = require(\"tfw.wdg.book\");\r\n * var book = new Book(\"book-id\");\r\n * book.show(\"game\");\r\n * @class Book\r\n */\r\nvar Book = function(book, hashPrefix) {\r\n    if (typeof book === 'string') {\r\n        book = document.getElementById(book);\r\n    }\r\n    Widget.call(this, {element: book});\r\n    book.$ctrl = this;\r\n    this.addClass(\"tfw-wdg-book\", \"fullscreen\");\r\n    var that = this,\r\n        i, child, id, pages = {}, current, count = 0;\r\n    for (i = 0 ; i < book.childNodes.length ; i++) {\r\n        child = book.childNodes[i];\r\n        if (child.nodeType != 1) continue;\r\n        child = new Widget({element: child});\r\n        id = child.attr(\"data-page\");\r\n        if (id && id.length > 0) {\r\n            child.addClass(\"page\");\r\n            if (!child.attr(\"data-index\")) {\r\n                child.attr(\"data-index\", count);\r\n            } else {\r\n                count = parseInt(child.attr(\"data-index\")) || 0;\r\n            }\r\n            pages[id] = child;\r\n            if (!current) {\r\n                current = child;\r\n                activate.call( this, child );\r\n            } else {\r\n                child.addClass(\"hide\");\r\n            }\r\n        } else {\r\n            child.addClass(\"overlay\");\r\n        }\r\n        count++;\r\n    }\r\n    this._pages = pages;\r\n    this._current = current;\r\n    if (!current) {\r\n        console.error(\"[tfw.wdg.book] Book without pages!\");\r\n        console.error(\"[tfw.wdg.book] Pages must have the \\\"data-page\\\" attribute!\");\r\n    }\r\n\r\n    // If hashPrefix has been set, we watch at the hash to change pages.\r\n    // For instance, if the prefix is \"MyBook\", the hash \"/MyBook/MyPage\"\r\n    // will switch to the page \"MyPage\" if it exists.\r\n    if (typeof hashPrefix !== 'undefined') {\r\n        Hash(function () {\r\n            var hashes = Hash.hash().split(';');\r\n            hashes.forEach(function (hash) {\r\n                hash = hash.trim();\r\n                var page;\r\n                if (hash.substr(0, hashPrefix.length + 2) == '/' + hashPrefix + '/') {\r\n                    page = hash.substr(hashPrefix.length + 2).trim();\r\n                    that.show(page);\r\n                }\r\n            });\r\n        });\r\n    }\r\n};\r\n\r\n// Extension of Widget.\r\nBook.prototype = Object.create(Widget.prototype);\r\nBook.prototype.constructor = Book;\r\n\r\n\r\n/**\r\n * @return void\r\n */\r\nBook.prototype.show = function(pageID) {\r\n    var rect;\r\n    var pages = this._pages;\r\n    var page = pages[pageID];\r\n    if( typeof page === 'undefined' ) {\r\n        console.error( \"[tfw.wdg.book.show] Unknown page `\" + pageID + \"`!\" );\r\n        return false;\r\n    }\r\n    var current = this._current;\r\n    var pageIdx = parseInt(page.attr(\"data-index\")) || 0;\r\n    var currentIdx = parseInt(current.attr(\"data-index\")) || 0;\r\n    if (!page || page == current) return;\r\n    current.removeClass(\"transition\");\r\n    current.removeClass(\"right\");\r\n    current.removeClass(\"hide\");\r\n    page.removeClass(\"transition\");\r\n    page.removeClass(\"right\");\r\n    page.removeClass(\"hide\");\r\n    if (currentIdx < pageIdx) {\r\n        page.addClass(\"right\");\r\n        rect = page.rect();\r\n        current.addClass(\"hide\");\r\n        page.removeClass(\"right\");\r\n    } else {\r\n        page.addClass(\"hide\");\r\n        rect = page.rect();\r\n        current.addClass(\"right\");\r\n        page.removeClass(\"hide\");\r\n    }\r\n    current.addClass(\"transition\");\r\n    page.addClass(\"transition\");\r\n    this._current = page;\r\n\r\n    activate.call( this, page );\r\n};\r\n\r\n\r\nfunction activate( page ) {\r\n    var autofocusable = page.element().querySelector(\"input[autofocus]\");\r\n    if( autofocusable ) {\r\n        window.setTimeout( autofocusable.focus.bind( autofocusable ), 300 );\r\n    }\r\n    var slotName = page.attr( 'data-activate' );\r\n    if( slotName ) {\r\n        var slot = window.APP[slotName];\r\n        if( typeof slot === 'function' ) {\r\n            slot( this );\r\n        }\r\n    }\r\n};\r\n\r\n\r\nBook.create = function(book, hashPrefix) {\r\n    return new Book(book, hashPrefix);\r\n};\r\nmodule.exports = Book;\r\n });\r\n","zip":"require(\"tfw.wdg.book\",function(t,e){\"use strict\";function a(t){var e=t.element().querySelector(\"input[autofocus]\");e&&window.setTimeout(e.focus.bind(e),300);var a=t.attr(\"data-activate\");if(a){var r=window.APP[a];\"function\"==typeof r&&r(this)}}var r=require(\"tfw.hash-watcher\"),s=require(\"wdg\"),o=function(t,e){\"string\"==typeof t&&(t=document.getElementById(t)),s.call(this,{element:t}),t.$ctrl=this,this.addClass(\"tfw-wdg-book\",\"fullscreen\");var o,i,n,d,l=this,h={},c=0;for(o=0;o<t.childNodes.length;o++)i=t.childNodes[o],1==i.nodeType&&(i=new s({element:i}),n=i.attr(\"data-page\"),n&&n.length>0?(i.addClass(\"page\"),i.attr(\"data-index\")?c=parseInt(i.attr(\"data-index\"))||0:i.attr(\"data-index\",c),h[n]=i,d?i.addClass(\"hide\"):(d=i,a.call(this,i))):i.addClass(\"overlay\"),c++);this._pages=h,this._current=d,d||(console.error(\"[tfw.wdg.book] Book without pages!\"),console.error('[tfw.wdg.book] Pages must have the \"data-page\" attribute!')),\"undefined\"!=typeof e&&r(function(){var t=r.hash().split(\";\");t.forEach(function(t){t=t.trim();var a;t.substr(0,e.length+2)==\"/\"+e+\"/\"&&(a=t.substr(e.length+2).trim(),l.show(a))})})};o.prototype=Object.create(s.prototype),o.prototype.constructor=o,o.prototype.show=function(t){var e,r=this._pages,s=r[t];if(\"undefined\"==typeof s)return console.error(\"[tfw.wdg.book.show] Unknown page `\"+t+\"`!\"),!1;var o=this._current,i=parseInt(s.attr(\"data-index\"))||0,n=parseInt(o.attr(\"data-index\"))||0;s&&s!=o&&(o.removeClass(\"transition\"),o.removeClass(\"right\"),o.removeClass(\"hide\"),s.removeClass(\"transition\"),s.removeClass(\"right\"),s.removeClass(\"hide\"),i>n?(s.addClass(\"right\"),e=s.rect(),o.addClass(\"hide\"),s.removeClass(\"right\")):(s.addClass(\"hide\"),e=s.rect(),o.addClass(\"right\"),s.removeClass(\"hide\")),o.addClass(\"transition\"),s.addClass(\"transition\"),this._current=s,a.call(this,s))},o.create=function(t,e){return new o(t,e)},e.exports=o});\n//# sourceMappingURL=tfw.wdg.book.js.map","map":{"version":3,"file":"tfw.wdg.book.js.map","sources":["tfw.wdg.book.js"],"sourcesContent":["require( 'tfw.wdg.book', function(exports, module) {  \"use strict\";\r\nvar Hash = require(\"tfw.hash-watcher\");\r\nvar Widget = require(\"wdg\");\r\n\r\n/**\r\n * @example\r\n * <div id=\"book-id\">\r\n *   <div data-page=\"welcome\">...</div>\r\n *   <div data-page=\"game\">...</div>\r\n *   <div data-page=\"highscores\">...</div>\r\n * </div>\r\n *\r\n * @example\r\n * var Book = require(\"tfw.wdg.book\");\r\n * var book = new Book(\"book-id\");\r\n * book.show(\"game\");\r\n * @class Book\r\n */\r\nvar Book = function(book, hashPrefix) {\r\n    if (typeof book === 'string') {\r\n        book = document.getElementById(book);\r\n    }\r\n    Widget.call(this, {element: book});\r\n    book.$ctrl = this;\r\n    this.addClass(\"tfw-wdg-book\", \"fullscreen\");\r\n    var that = this,\r\n        i, child, id, pages = {}, current, count = 0;\r\n    for (i = 0 ; i < book.childNodes.length ; i++) {\r\n        child = book.childNodes[i];\r\n        if (child.nodeType != 1) continue;\r\n        child = new Widget({element: child});\r\n        id = child.attr(\"data-page\");\r\n        if (id && id.length > 0) {\r\n            child.addClass(\"page\");\r\n            if (!child.attr(\"data-index\")) {\r\n                child.attr(\"data-index\", count);\r\n            } else {\r\n                count = parseInt(child.attr(\"data-index\")) || 0;\r\n            }\r\n            pages[id] = child;\r\n            if (!current) {\r\n                current = child;\r\n                activate.call( this, child );\r\n            } else {\r\n                child.addClass(\"hide\");\r\n            }\r\n        } else {\r\n            child.addClass(\"overlay\");\r\n        }\r\n        count++;\r\n    }\r\n    this._pages = pages;\r\n    this._current = current;\r\n    if (!current) {\r\n        console.error(\"[tfw.wdg.book] Book without pages!\");\r\n        console.error(\"[tfw.wdg.book] Pages must have the \\\"data-page\\\" attribute!\");\r\n    }\r\n\r\n    // If hashPrefix has been set, we watch at the hash to change pages.\r\n    // For instance, if the prefix is \"MyBook\", the hash \"/MyBook/MyPage\"\r\n    // will switch to the page \"MyPage\" if it exists.\r\n    if (typeof hashPrefix !== 'undefined') {\r\n        Hash(function () {\r\n            var hashes = Hash.hash().split(';');\r\n            hashes.forEach(function (hash) {\r\n                hash = hash.trim();\r\n                var page;\r\n                if (hash.substr(0, hashPrefix.length + 2) == '/' + hashPrefix + '/') {\r\n                    page = hash.substr(hashPrefix.length + 2).trim();\r\n                    that.show(page);\r\n                }\r\n            });\r\n        });\r\n    }\r\n};\r\n\r\n// Extension of Widget.\r\nBook.prototype = Object.create(Widget.prototype);\r\nBook.prototype.constructor = Book;\r\n\r\n\r\n/**\r\n * @return void\r\n */\r\nBook.prototype.show = function(pageID) {\r\n    var rect;\r\n    var pages = this._pages;\r\n    var page = pages[pageID];\r\n    if( typeof page === 'undefined' ) {\r\n        console.error( \"[tfw.wdg.book.show] Unknown page `\" + pageID + \"`!\" );\r\n        return false;\r\n    }\r\n    var current = this._current;\r\n    var pageIdx = parseInt(page.attr(\"data-index\")) || 0;\r\n    var currentIdx = parseInt(current.attr(\"data-index\")) || 0;\r\n    if (!page || page == current) return;\r\n    current.removeClass(\"transition\");\r\n    current.removeClass(\"right\");\r\n    current.removeClass(\"hide\");\r\n    page.removeClass(\"transition\");\r\n    page.removeClass(\"right\");\r\n    page.removeClass(\"hide\");\r\n    if (currentIdx < pageIdx) {\r\n        page.addClass(\"right\");\r\n        rect = page.rect();\r\n        current.addClass(\"hide\");\r\n        page.removeClass(\"right\");\r\n    } else {\r\n        page.addClass(\"hide\");\r\n        rect = page.rect();\r\n        current.addClass(\"right\");\r\n        page.removeClass(\"hide\");\r\n    }\r\n    current.addClass(\"transition\");\r\n    page.addClass(\"transition\");\r\n    this._current = page;\r\n\r\n    activate.call( this, page );\r\n};\r\n\r\n\r\nfunction activate( page ) {\r\n    var autofocusable = page.element().querySelector(\"input[autofocus]\");\r\n    if( autofocusable ) {\r\n        window.setTimeout( autofocusable.focus.bind( autofocusable ), 300 );\r\n    }\r\n    var slotName = page.attr( 'data-activate' );\r\n    if( slotName ) {\r\n        var slot = window.APP[slotName];\r\n        if( typeof slot === 'function' ) {\r\n            slot( this );\r\n        }\r\n    }\r\n};\r\n\r\n\r\nBook.create = function(book, hashPrefix) {\r\n    return new Book(book, hashPrefix);\r\n};\r\nmodule.exports = Book;\r\n });\r\n"],"names":["require","exports","module","activate","page","autofocusable","element","querySelector","window","setTimeout","focus","bind","slotName","attr","slot","APP","this","Hash","Widget","Book","book","hashPrefix","document","getElementById","call","$ctrl","addClass","i","child","id","current","that","pages","count","childNodes","length","nodeType","parseInt","_pages","_current","console","error","hashes","hash","split","forEach","trim","substr","show","prototype","Object","create","constructor","pageID","rect","pageIdx","currentIdx","removeClass"],"mappings":"AAAAA,QAAS,eAAgB,SAASC,EAASC,GAAW,YAyHtD,SAASC,GAAUC,GACf,GAAIC,GAAgBD,EAAKE,UAAUC,cAAc,mBAC7CF,IACAG,OAAOC,WAAYJ,EAAcK,MAAMC,KAAMN,GAAiB,IAElE,IAAIO,GAAWR,EAAKS,KAAM,gBAC1B,IAAID,EAAW,CACX,GAAIE,GAAON,OAAOO,IAAIH,EACF,mBAATE,IACPA,EAAME,OAjIlB,GAAIC,GAAOjB,QAAQ,oBACfkB,EAASlB,QAAQ,OAgBjBmB,EAAO,SAASC,EAAMC,GACF,gBAATD,KACPA,EAAOE,SAASC,eAAeH,IAEnCF,EAAOM,KAAKR,MAAOV,QAASc,IAC5BA,EAAKK,MAAQT,KACbA,KAAKU,SAAS,eAAgB,aAC9B,IACIC,GAAGC,EAAOC,EAAgBC,EAD1BC,EAAOf,KACOgB,KAAqBC,EAAQ,CAC/C,KAAKN,EAAI,EAAIA,EAAIP,EAAKc,WAAWC,OAASR,IACtCC,EAAQR,EAAKc,WAAWP,GACF,GAAlBC,EAAMQ,WACVR,EAAQ,GAAIV,IAAQZ,QAASsB,IAC7BC,EAAKD,EAAMf,KAAK,aACZgB,GAAMA,EAAGM,OAAS,GAClBP,EAAMF,SAAS,QACVE,EAAMf,KAAK,cAGZoB,EAAQI,SAAST,EAAMf,KAAK,gBAAkB,EAF9Ce,EAAMf,KAAK,aAAcoB,GAI7BD,EAAMH,GAAMD,EACPE,EAIDF,EAAMF,SAAS,SAHfI,EAAUF,EACVzB,EAASqB,KAAMR,KAAMY,KAKzBA,EAAMF,SAAS,WAEnBO,IAEJjB,MAAKsB,OAASN,EACdhB,KAAKuB,SAAWT,EACXA,IACDU,QAAQC,MAAM,sCACdD,QAAQC,MAAM,8DAMQ,mBAAfpB,IACPJ,EAAK,WACD,GAAIyB,GAASzB,EAAK0B,OAAOC,MAAM,IAC/BF,GAAOG,QAAQ,SAAUF,GACrBA,EAAOA,EAAKG,MACZ,IAAI1C,EACAuC,GAAKI,OAAO,EAAG1B,EAAWc,OAAS,IAAM,IAAMd,EAAa,MAC5DjB,EAAOuC,EAAKI,OAAO1B,EAAWc,OAAS,GAAGW,OAC1Cf,EAAKiB,KAAK5C,QAQ9Be,GAAK8B,UAAYC,OAAOC,OAAOjC,EAAO+B,WACtC9B,EAAK8B,UAAUG,YAAcjC,EAM7BA,EAAK8B,UAAUD,KAAO,SAASK,GAC3B,GAAIC,GACAtB,EAAQhB,KAAKsB,OACblC,EAAO4B,EAAMqB,EACjB,IAAoB,mBAATjD,GAEP,MADAoC,SAAQC,MAAO,qCAAuCY,EAAS,OACxD,CAEX,IAAIvB,GAAUd,KAAKuB,SACfgB,EAAUlB,SAASjC,EAAKS,KAAK,gBAAkB,EAC/C2C,EAAanB,SAASP,EAAQjB,KAAK,gBAAkB,CACpDT,IAAQA,GAAQ0B,IACrBA,EAAQ2B,YAAY,cACpB3B,EAAQ2B,YAAY,SACpB3B,EAAQ2B,YAAY,QACpBrD,EAAKqD,YAAY,cACjBrD,EAAKqD,YAAY,SACjBrD,EAAKqD,YAAY,QACAF,EAAbC,GACApD,EAAKsB,SAAS,SACd4B,EAAOlD,EAAKkD,OACZxB,EAAQJ,SAAS,QACjBtB,EAAKqD,YAAY,WAEjBrD,EAAKsB,SAAS,QACd4B,EAAOlD,EAAKkD,OACZxB,EAAQJ,SAAS,SACjBtB,EAAKqD,YAAY,SAErB3B,EAAQJ,SAAS,cACjBtB,EAAKsB,SAAS,cACdV,KAAKuB,SAAWnC,EAEhBD,EAASqB,KAAMR,KAAMZ,KAmBzBe,EAAKgC,OAAS,SAAS/B,EAAMC,GACzB,MAAO,IAAIF,GAAKC,EAAMC,IAE1BnB,EAAOD,QAAUkB"},"dependencies":["mod/tfw.wdg.book","mod/tfw.hash-watcher","mod/wdg"]}